# auth-api
 API сервиса аутентификации и авторизации в приложение Твой ФФ!

## Запуск

1) Перейдите в папку проекта

2) Создайте виртуальное окружение командой и активируйте его:
```console
foo@bar:~$ python3 -m venv venv
foo@bar:~$ source ./venv/bin/activate  # На MacOS и Linux
foo@bar:~$ venv\Scripts\activate  # На Windows
```

3) Установите библиотеки
```console
foo@bar:~$ pip install -r requirements.txt
```
4) Запускайте приложение!
```console
foo@bar:~$ python -m auth_backend
```

## ENV-file description

DB_DSN=postgresql://admin:admin@localhost:5432/?
EMAIL_PASS=
EMAIL=
HOST=

---

## Сценарий использования
### Что надо сделать чтобы зарегистрировать пользователя через email

1. Дернуть ручку `POST /email/registrate` . Вы передаете `{email: "", password: ""}`
2. На почту приходит письмо с линком на `GET /email/approve?token='...'`, если по ней перейти то почта будет подтверждена и регистрацию можно считать завершенной.

### Что надо сделать чтобы залогиниться через email

1. Дернуть ручку `POST /email/login`. там всего один вариант логина, никуда не денетесь 
2. Вам придет токен, сохраняйте его кууда нибудь, срок действия ограничен.

### Забыли пароль

1. Дернуть ручку `POST /email/reset/password/request`. Вы передаете `{email: ""}`в нагрузке 
2. Вам придет письмо, где будет ссылка НА ФРОНТ(надо сделать это), в ссылке будет reset_token
3. Токен надо передать в ручку `POST /email/reset/password` в заголовках, вместе с `{email: "", new_password: ""}` и пароль будет изменен. email не понадобится после решения #36
        
### Смена пароля 

1. Если пароль не забыт, а просто надо его поменять. Тогда в `POST /email/reset/password/request` передается токен авторизации, в теле вы передаете `{email: "", password: "", new_password: ""}`
2. Отправляете запрос и всё, пароль изменен, вам придет письмо с уведомлением о смене пароляю

### Что надо сделать, чтобы поменять почту

1. Дернуть ручку `POST /email/reset/email/request`. Всего один вариант, передаете новое мыло в теле `{email: ""}` и токен атворизации в заголовках
2. На почту придет письмо с подтверждением почты, там будет токен подтверждения в query параметрах. Ссылка ведет на ручку GET пока что, но надо переделать, чтобы тоже вела на фронт.
        
